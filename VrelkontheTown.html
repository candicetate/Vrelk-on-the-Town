<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:wght@300;400;500;700;900&display=swap" rel="stylesheet">
  <title>Vrelk on the Town</title>
  <style>
/* Color Palette
Light Brown #E6D69C
Mid Brown #B4A56A
Grey #7B7162
Dark Grey #393829
*/

*, *::before, *::after {
  box-sizing: border-box;
  font-family: 'Source Code Pro', monospace;
}

body {
    align-items:center;
    background-color: #7B7162;
    color: #393829;
    display: flex;
    font-weight: 700;
    height: 100vh;
    justify-content:center;
    margin: 0;
    padding: 0;
    width: 100vw;
}

.btn-grid {
    display: grid;
    gap: 10px;
    grid-template-columns: repeat(2, auto);
    margin-top: 20px;
}

.btn {
    background-color: #7B7162;
    border-radius: 5px;
    box-shadow: 0 2px 0 2px #393829;
    color: #E6D69C;
    outline: none;
    width: 225px;
}

.btn:hover {
    background-color: #393829;
    cursor: pointer;
}

.container {
    background-color: #E6D69C;
    border-radius: 10px;
    box-shadow: 0 5px 0 5px #B4A56A;
    max-width: 80%;
    padding: 20px;
}

  </style>
</head>
<body>
    <div class="container">
<div id="text">
    Story text
</div>
<div id="options" class="btn-grid">
<button class="btn">Option 1</button>
<button class="btn">Option 2</button>
<button class="btn">Option 3</button>
<button class="btn">Option 4</button>
</div>
    </div>
    </body>
<script>
    const textElement = document.getElementById('text')
    const optionButtonsElement = document.getElementById('options')

    let state = {}

    function startGame() {
         state = {}
         showTextNode(1)
    }

    function showTextNode(textNodeIndex){
        const textNode = textNodes.find(textNode => textNode.id === textNodeIndex)
        textElement.innerText = textNode.text
        while (optionButtonsElement.firstChild) {
            optionButtonsElement.removeChild(optionButtonsElement.firstChild)
        }
        
    textNode.options.forEach(option => {
        if (showOption(option)) {
             const button = document.createElement('button')
             button.innerText = option.text
             button.classList.add('btn')
             button.addEventListener('click', () => selectOption(option))
             optionButtonsElement.appendChild(button)
        }
    })
    }

    function showOption(option) {
        return option.requiredState == null || option.requiredState(state)
    }

    function selectOption(option) {
        const nextTextNodeID = option.nextText
        state = Object.assign(state, option.setState)
        showTextNode(nextTextNodeID)
    }

    const textNodes = [
       {
           id: 1,
           text: 'Vrek wakes up in a dark place. He is not quite sure exactly where he is. He has a slight headache',
           options: [
               {
                text: 'Wiggle around',
                nextText: 2
               },
               {
                text: 'Accept your fate & go back to sleep',
                setState: {wellRested: true},
                nextText: 3
               },
           ]
       },

       {
           id: 2,
           text: 'Vrelk can wiggle his way out of whatever this is. It worked in ther past so why not now? Vrelk violently wiggles and everything around him starts moving. He hears the cracking of wood as he collides with the ground.' ,
           options: [
               {
                text: 'Collect yourself and look around',
                nextText: 4
               },
               {
                text: 'Regret that you missed a chance to sleep longer',
                nextText: 4
               },
           ]
       },

       {
           id: 3,
           text: 'Back to sleep it is! Surely this problem will sort itself out. After an undetermined amount of time, Vrelk awakens in the same dark place. It is slightly warmer and he still has a headache' ,
           options: [
               {
                text: 'Wiggle for you life',
                nextText: 2,
                requiredState: (currentState) => currentState.wellRested,
                setState: {wellRested: false},
                nextText: 2
               },
               {
                text: 'Wiggle with as much strength as you are willing to commit at this time',
                nextText: 2
               },
           ]
       },

       {
           id: 4,
           text: '"OW! SON OF A…" Vrelk falls out of a barrel in an alley. It looks to be about noon. He’s not sure how he got there. "How did I end up in a barrel?" he wonders. Vrelk looks beyond the alley to see a town he’s not familiar with. The alley is full of barrels, crates and random junk. "Also where am I?"' ,
           options: [
               {
                text: 'Check your items',
                nextText: 5,
               },
               
           ]
       },

       {
           id: 5,
           text: 'Vrelk notices that his wallet is missing. "… AND WHERE IS ALL MY MONEY?!" He starts frantically checking his pockets. "Someone must have stolen it! That’s the only logical explanation!" Ignoring the smell of ale on his entire self, he decides to get to the bottom of this.' ,
           options: [
               {
                text: 'Leave the alley',
                nextText: 6,
               },
               
           ]
       },

       {
           id: 6,
           text: 'Vrelk walks towards the opening of the alley to head into town. He’s unaware that there is a wanted poster in the background with his picture on it. The poster reads: WANTED: VRELK for thievery, gambling, public nudity. "I’m going to go get that sucker who stole my money!"' ,
           options: [
               {
                text: 'Talk to a man in the street',
                nextText: 7,
               },
               {
                text: 'Talk to an Orc in armor handing out leaflets',
                nextText: 8,
               },
               {
                text: 'Look around',
                nextText: 9,
               },
               {
                text: 'Go in to the Tavern',
                nextText: 10,
               },
               
           ]
       },

    ]

    startGame();

</script>
</html>